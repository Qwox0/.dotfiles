# set == set-option
# set -g: global
# set -a: append

set -sa terminal-overrides ",xterm*:Tc"
set -g default-terminal "tmux-256color"
set -s escape-time 0
set -g status-style "bg=#333333 fg=#5eacd3"
set -g base-index 1
set -g mode-keys vi
set -g history-limit 10000
set -g mouse on

# if-shell -F command: if -F "return 0 or 1" "tmux command if 1" "tmux command if 0"

# show all keybindings: `tmux list-keys` or `prefix : list-keys`

# bind -n: don't use prefix key
# bind -r: repeatable (prefix + key + key + key + ... possible)

# unbind C-b
# set -g prefix C-Space
# bind C-Space send-prefix

bind -r t new-window
bind -r q killp
bind -r C-t new-window
bind -r C-q killp

bind -r n next-window
bind -r b previous-window
bind -r C-n next-window
bind -r C-b previous-window
bind -nr C-n next-window
bind -nr C-b previous-window

bind v copy-mode
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'xclip -i -sel clipboard'

bind -n MouseDown2Pane run "xclip -o -sel primary | tmux load-buffer - ; tmux paste-buffer"
#bind -n MouseDown2Pane if -F '#{?#{m:*vim*,#{pane_current_command}},0,1}' 'display "test: #{pane_current_command}"'
#bind -n MouseDown2Pane if -F '#{m:*vim*,#{pane_current_command}}' '' 'display "test: #{pane_current_command}"'

# mouse drag also copies to mouse clipboard (todo: don't copy to other clipboard)
bind -T copy-mode MouseDragEnd1Pane send-keys -X copy-pipe-no-clear "xclip -i -sel primary"
#bind -T copy-mode MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -i -sel primary"
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-no-clear "xclip -i -sel primary"
#bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -i -sel primary"

bind -T copy-mode-vi DoubleClick1Pane select-pane \; send-keys -X select-word-no-clear \; send-keys -X copy-pipe-no-clear "xclip -in -sel primary"
bind -n DoubleClick1Pane if -F '#{m:*vim*,#{pane_current_command}}' '' 'select-pane \; copy-mode -M \; send-keys -X select-word \; send-keys -X copy-pipe-no-clear "xclip -in -sel primary"'

bind -T copy-mode MouseDown1Pane send-keys -X cancel
bind -T copy-mode-vi MouseDown1Pane send-keys -X cancel

#bind -r ^ last-window
bind -r k select-pane -U
bind -r j select-pane -D
bind -r h select-pane -L
bind -r l select-pane -R

bind r source-file ~/.tmux.conf \; display-message "`~/.tmux.conf` reloaded"

bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t= \; send-keys -M on

unbind -T copy-mode-vi C-b
unbind -T copy-mode C-b

#bind -r D neww -c "#{pane_current_path}" "[[ -e TODO.md ]] && nvim TODO.md || nvim ~/.dotfiles/personal/todo.md"

bind -nr C-f run-shell "tmux neww ~/.dotfiles/scripts/tmux-sessionizer"
bind -r O run-shell "~/.local/bin/tmux-sessionizer ~/work/nrdp"
